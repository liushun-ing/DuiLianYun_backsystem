(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["NewsRelease"],{"49f1":function(e,t,r){},"63de":function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"crumbs"},[r("el-breadcrumb",{attrs:{separator:"/"}},[r("el-breadcrumb-item",[r("i",{staticClass:"el-icon-lx-cascades"}),e._v(" 新闻发布\n            ")])],1)],1),r("div",{staticClass:"container"},[r("div",{staticClass:"title_and_action"},[r("div",{staticClass:"title_wrap"},[e._v("新闻发布")]),r("div",[r("el-button",{attrs:{type:"warning"},on:{click:e.reset}},[e._v("重置")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit("newsForm")}}},[e._v("发布新闻")])],1)]),r("el-form",{ref:"newsForm",attrs:{model:e.newsForm,rules:e.rules}},[r("el-descriptions",{attrs:{direction:"vertical",column:3,border:"",size:"medium"}},[r("el-descriptions-item",{attrs:{label:"标题",span:1}},[r("el-form-item",{attrs:{prop:"newsTitle"}},[r("el-input",{attrs:{type:"textarea",autosize:""},on:{input:e.inputTitle},model:{value:e.newsForm.newsTitle,callback:function(t){e.$set(e.newsForm,"newsTitle",t)},expression:"newsForm.newsTitle"}})],1)],1),r("el-descriptions-item",{attrs:{label:"编辑人",span:1}},[r("el-form-item",{attrs:{prop:"newsEditor"}},[r("el-input",{on:{input:e.inputEditor},model:{value:e.newsForm.newsEditor,callback:function(t){e.$set(e.newsForm,"newsEditor",t)},expression:"newsForm.newsEditor"}})],1)],1),r("el-descriptions-item",{attrs:{label:"发布时间",span:1}},[r("el-form-item",{attrs:{prop:"newsCreateTime"}},[r("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},on:{change:e.inputDate},model:{value:e.newsForm.newsCreateTime,callback:function(t){e.$set(e.newsForm,"newsCreateTime",t)},expression:"newsForm.newsCreateTime"}})],1)],1),r("el-descriptions-item",{attrs:{label:"封面图（可选项），<<最优宽高比为2:1>>",span:3}},[r("el-form-item",[r("el-upload",{ref:"upload",staticClass:"n-avatar-uploader",attrs:{action:"uploadUrl","show-file-list":!1,limit:1,"http-request":e.uploadPicture,"before-upload":e.beforeAvatarUpload}},[e.newsForm.newsImage?r("el-image",{staticClass:"n-avatar",attrs:{src:e.newsForm.newsImage,fit:"contain"}}):r("i",{staticClass:"el-icon-plus n-avatar-uploader-icon"})],1)],1)],1),r("el-descriptions-item",{attrs:{label:"新闻内容(注意排版哟，系统会为您自动添加标题和编辑等信息)",span:3}},[r("el-form-item",{attrs:{prop:"newsContent"}},[r("mavon-editor",{ref:"md",attrs:{toolbars:e.toolbars,autofocus:!1},on:{imgAdd:e.$imgAdd,imgDel:e.$imgDel},model:{value:e.newsForm.newsContent,callback:function(t){e.$set(e.newsForm,"newsContent",t)},expression:"newsForm.newsContent"}})],1)],1)],1)],1)],1)])},n=[],a=(r("96cf"),r("1da1")),i=r("fa7d"),o={name:"NewsRelease",data:function(){return{toolbars:i["a"].toolbars,newsForm:{newsTitle:"",newsContent:"",newsImage:"",newsCreateTime:"",newsEditor:"",newsCreatorId:""},rules:{newsTitle:[{required:!0,message:"请输入新闻标题",trigger:"blur"}],newsEditor:[{required:!0,message:"请输入新闻编辑人",trigger:"blur"}],newsCreateTime:[{required:!0,message:"请输入新闻发布时间",trigger:["blur"]}],newsContent:[{required:!0,message:"请输入新闻内容",trigger:"blur"}]}}},activated:function(){},methods:{$imgAdd:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,r){var s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.beforeAvatarUpload(r)){e.next=2;break}return e.abrupt("return");case 2:return s=this.$message({message:"正在上传中...",type:"info",duration:0}),e.prev=3,e.next=6,i["a"].uploadFile("/post-server/manuscript/upload",r);case 6:n=e.sent,this.$refs.md.$img2Url(t,n.url),s.close(),this.$message({message:"图片上传成功",duration:2e3,type:"success"}),e.next=17;break;case 12:e.prev=12,e.t0=e["catch"](3),s.close(),this.$message({message:"图片上传失败",duration:2e3,type:"error"}),console.log(e.t0);case 17:case"end":return e.stop()}}),e,this,[[3,12]])})));function t(t,r){return e.apply(this,arguments)}return t}(),$imgDel:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,r){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s={url:t[0]},e.prev=1,e.next=4,this.$api.news.deleteImage(s);case 4:console.log("新闻内容图片删除成功"),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](1),console.log("新闻内容图片删除失败"),console.log(e.t0);case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));function t(t,r){return e.apply(this,arguments)}return t}(),uploadPicture:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i["a"].uploadFile("/post-server/manuscript/upload",t.file);case 3:r=e.sent,this.$set(this.newsForm,"newsImage",r.url),this.$message({message:"图片上传成功",duration:2e3,type:"success"}),this.$refs.upload.clearFiles(),e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](0),console.log(e.t0),this.$message({message:"图片上传失败",duration:2e3,type:"error"});case 13:case"end":return e.stop()}}),e,this,[[0,9]])})));function t(t){return e.apply(this,arguments)}return t}(),beforeAvatarUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type;return t?this.$message({message:"上传中",duration:1e3,type:"info"}):this.$message.error("上传封面图片只能是 JPG或者PNG 格式!"),t},submit:function(e){var t=this;this.$refs[e].validate(function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!r){e.next=16;break}return e.prev=1,t.newsForm.newsContent="# "+t.newsForm.newsTitle+"\n\n*编辑："+t.newsForm.newsEditor+" 编辑时间："+t.newsForm.newsCreateTime+"* \n\n"+t.newsForm.newsContent,t.newsForm.newsCreatorId=i["a"].getSessionInfo("adminId"),e.next=6,t.$api.news.releaseNews(t.newsForm);case 6:t.$message({message:"发布成功",duration:2e3,type:"success"}),t.reset(),e.next=14;break;case 10:e.prev=10,e.t0=e["catch"](1),t.$message({message:"发布失败",duration:2e3,type:"error"}),console.log(e.t0);case 14:e.next=18;break;case 16:return console.log("修改新闻表单验证失败"),e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}())},reset:function(){this.newsForm={newsTitle:"",newsContent:"",newsImage:"",newsCreateTime:"",newsEditor:"",newsCreatorId:""},this.$refs["newsForm"].clearValidate()}}},l=o,c=(r("bb55"),r("0c7c")),u=Object(c["a"])(l,s,n,!1,null,null,null);t["default"]=u.exports},bb55:function(e,t,r){"use strict";r("49f1")}}]);
//# sourceMappingURL=NewsRelease.2b82adef.js.map
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["AwardDistribute"],{"2d3a":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-lx-cascades"}),t._v(" 奖项分配\n            ")])],1)],1),a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[t._v("\n            请选择比赛场次: \n            "),a("el-select",{attrs:{placeholder:"请选择"},on:{change:t.changeCompetitionOptions},model:{value:t.selectedCompetitionId,callback:function(e){t.selectedCompetitionId=e},expression:"selectedCompetitionId"}},t._l(t.competitionOptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",icon:"el-icon-refresh"},on:{click:t.handleRefresh}},[t._v("刷新")])],1),a("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:t.distributeList,border:"","empty-text":t.emptyText,"header-cell-class-name":"table-header"}},[a("el-table-column",{attrs:{label:"作品",align:"center","min-width":"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"limit_wrap"},[t._v(t._s(e.row.manuscriptContent))])]}}])}),a("el-table-column",{attrs:{prop:"score1",label:"一审得分","min-width":"80",align:"center"}}),a("el-table-column",{attrs:{label:"一审评语",align:"center","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"limit_wrap"},[t._v(t._s(e.row.comment1))])]}}])}),a("el-table-column",{attrs:{prop:"score2",label:"二审得分","min-width":"80",align:"center"}}),a("el-table-column",{attrs:{label:"二审评语",align:"center","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"limit_wrap"},[t._v(t._s(e.row.comment2))])]}}])}),a("el-table-column",{attrs:{label:"获奖情况","min-width":"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.awardDetail?a("div",[a("el-tag",{attrs:{type:"danger"}},[t._v(t._s(e.row.awardDetail))])],1):t._e()]}}])}),a("el-table-column",{attrs:{label:"获奖作品",align:"center","min-width":"250"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"limit_wrap"},[t._v(t._s(e.row.awardContent))])]}}])}),a("el-table-column",{attrs:{label:"操作",width:"100",align:"center",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return["0"===e.row.status?a("div",[a("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(a){return t.handleAward(e.$index,e.row)}}},[t._v("评奖")])],1):a("div",[a("el-button",{attrs:{type:"text",icon:"el-icon-view"},on:{click:function(a){return t.handleView(e.$index,e.row)}}},[t._v("查看")])],1)]}}])})],1),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":t.currentPage,"page-size":t.pageSize,total:t.total},on:{"current-change":t.handlePageChange,"prev-click":t.handlePagePrev,"next-click":t.handlePageNext}})],1)],1),a("el-dialog",{attrs:{title:"评选",visible:t.awardVisible,width:"70%","show-close":!1,"close-on-click-modal":!1},on:{"update:visible":function(e){t.awardVisible=e}}},[a("div",{staticClass:"award_wrap"},[a("div",{staticClass:"award_left"},[a("el-descriptions",{attrs:{direction:"vertical",column:2,border:""}},[a("el-descriptions-item",{attrs:{label:"一审得分"}},[t._v(t._s(t.awardLeftForm.score1))]),a("el-descriptions-item",{attrs:{label:"二审得分"}},[t._v(t._s(t.awardLeftForm.score2))]),a("el-descriptions-item",{attrs:{label:"一审评语"}},[t._v(t._s(t.awardLeftForm.comment1))]),a("el-descriptions-item",{attrs:{label:"二审评语"}},[t._v(t._s(t.awardLeftForm.comment2))]),a("el-descriptions-item",{attrs:{label:"投稿内容"}},[a("div",{domProps:{innerHTML:t._s(t.awardLeftForm.manuscriptContent)}})])],1)],1),a("div",{staticClass:"award_right"},[a("el-form",{ref:"awardRightForm",attrs:{model:t.awardRightForm,rules:t.rules}},[a("el-descriptions",{attrs:{direction:"vertical",column:1,border:""}},[a("el-descriptions-item",{attrs:{label:"选择奖项"}},[a("el-form-item",{attrs:{prop:"awardDetail"}},[a("el-radio-group",{model:{value:t.awardRightForm.awardDetail,callback:function(e){t.$set(t.awardRightForm,"awardDetail",e)},expression:"awardRightForm.awardDetail"}},[a("el-radio",{attrs:{label:"特等奖"}},[t._v("特等奖")]),a("el-radio",{attrs:{label:"一等奖"}},[t._v("一等奖")]),a("el-radio",{attrs:{label:"二等奖"}},[t._v("二等奖")]),a("el-radio",{attrs:{label:"三等奖"}},[t._v("三等奖")])],1)],1)],1),a("el-descriptions-item",{attrs:{label:"挑选获奖部分(注意排版哟)，可点击工具栏右侧预览查看最终效果"}},[a("el-form-item",{attrs:{prop:"awardContent"}},[a("mavon-editor",{ref:"md",attrs:{toolbars:t.awardToolbars,subfield:!1,autofocus:!1},on:{change:t.changeContent},model:{value:t.awardRightForm.awardContentMarkdown,callback:function(e){t.$set(t.awardRightForm,"awardContentMarkdown",e)},expression:"awardRightForm.awardContentMarkdown"}})],1)],1)],1)],1)],1)]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.cancelAward}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.saveAward("awardRightForm")}}},[t._v("确 定")])],1)]),a("el-dialog",{attrs:{title:"查看",visible:t.viewVisible,width:"70%"},on:{"update:visible":function(e){t.viewVisible=e}}},[a("div",{staticClass:"award_wrap"},[a("div",{staticClass:"award_left"},[a("el-descriptions",{attrs:{direction:"vertical",column:2,border:""}},[a("el-descriptions-item",{attrs:{label:"一审得分"}},[t._v(t._s(t.viewForm.score1))]),a("el-descriptions-item",{attrs:{label:"二审得分"}},[t._v(t._s(t.viewForm.score2))]),a("el-descriptions-item",{attrs:{label:"一审评语"}},[t._v(t._s(t.viewForm.comment1))]),a("el-descriptions-item",{attrs:{label:"二审评语"}},[t._v(t._s(t.viewForm.comment2))]),a("el-descriptions-item",{attrs:{label:"投稿内容"}},[a("div",{domProps:{innerHTML:t._s(t.viewForm.manuscriptContent)}})])],1)],1),a("div",{staticClass:"award_right"},[a("el-descriptions",{attrs:{direction:"vertical",column:1,border:""}},[a("el-descriptions-item",{attrs:{label:"获奖奖项"}},[a("el-tag",{attrs:{type:"danger"}},[t._v(t._s(t.viewForm.awardDetail))])],1),a("el-descriptions-item",{attrs:{label:"获奖部分作品"}},[a("mavon-editor",{staticClass:"md",attrs:{value:t.viewForm.awardContentMarkdown,subfield:!1,defaultOpen:"preview",toolbarsFlag:!1,editable:!1,scrollStyle:!0,ishljs:!0}})],1)],1)],1)])])],1)},r=[],n=(a("a481"),a("ac6a"),a("96cf"),a("1da1")),s=(a("55dd"),a("fa7d")),o={name:"AwardDistribute",data:function(){return{competitionList:[],selectedCompetitionId:"",competitionOptions:[],awardToolbars:s["a"].awardToolbars,distributeList:[],emptyText:"暂无数据",currentPage:1,pageSize:10,total:0,totalRecheck:0,awardVisible:!1,awardIndex:-1,awardLeftForm:{},awardRightForm:{},viewVisible:!1,viewIndex:-1,viewForm:{},rules:{awardDetail:[{required:!0,message:"请选择奖项",trigger:"blur"}],awardContent:[{required:!0,message:"请挑选获奖部分",trigger:"blur"}]}}},activated:function(){this.getCompetitionList()},methods:{sortByTime:function(t){return t.sort((function(t,e){var a=new Date(t.createTime).getTime(),i=new Date(e.createtime).getTime();return a>i?-1:a<i?1:0}))},getCompetitionList:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$api.competition.getAllCompetition();case 3:e=t.sent,this.competitionList=this.sortByTime(e.competitionList),a=[],this.competitionList.forEach((function(t,e){a.push({value:t.competitionId,label:t.competitionName})})),this.competitionOptions=a,t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](0),this.$message({message:"获取比赛列表失败",duration:2e3,type:"error"}),console.log(t.t0);case 14:case"end":return t.stop()}}),t,this,[[0,10]])})));function e(){return t.apply(this,arguments)}return e}(),changeCompetitionOptions:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e&&(this.selectedCompetitionId=e,this.reset(),this.getDistributeList());case 1:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),getDistributeList:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={competitionId:this.selectedCompetitionId,pageSize:this.pageSize,currentPage:this.currentPage},t.prev=1,t.next=4,this.$api.competition.getDistributeList(e);case 4:a=t.sent,a.total==a.totalRecheck?(this.distributeList=a.distributeList,this.total=a.total,this.totalRecheck=a.totalRecheck):this.emptyText="一审和二审还未结束噢!",t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](1),this.$message({message:"获取投稿列表失败",duration:2e3,type:"error"}),console.log(t.t0);case 12:case"end":return t.stop()}}),t,this,[[1,8]])})));function e(){return t.apply(this,arguments)}return e}(),handleRefresh:function(){var t=this.$message("刷新中");this.getDistributeList(),t.close()},handleView:function(t,e){this.viewIndex=t,this.viewVisible=!0;var a=JSON.parse(JSON.stringify(e));a.manuscriptContent=s["a"].formatText(a.manuscriptContent),this.viewForm=a},cancelAward:function(){this.awardVisible=!1,this.$message({message:"操作已取消",duration:1500,type:"info"}),this.$refs["awardRightForm"].clearValidate()},handleAward:function(t,e){this.awardIndex=t,this.awardVisible=!0;var a=JSON.parse(JSON.stringify(e));a.manuscriptContent=s["a"].formatText(a.manuscriptContent),this.awardLeftForm=a,this.awardRightForm={awardCompetitionId:"",awardUserId:"",awardManuscriptId:"",awardContent:"",awardContentMarkdown:"",awardDetail:""}},changeContent:function(t,e){var a=e.replace(/<\/?[^>]*>/g,"");this.awardRightForm.awardContent=a},saveAward:function(t){var e=this;this.$refs[t].validate(function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(a){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a){t.next=20;break}return e.awardVisible=!1,e.awardRightForm.awardCompetitionId=e.selectedCompetitionId,e.awardRightForm.awardUserId=e.awardLeftForm.manuscriptUserId,e.awardRightForm.awardManuscriptId=e.awardLeftForm.manuscriptId,t.prev=5,t.next=8,e.$api.competition.distributeAward(e.awardRightForm);case 8:e.$message({message:"分配奖项成功",duration:2e3,type:"success"}),e.$set(e.distributeList[e.awardIndex],"awardDetail",e.awardRightForm.awardDetail),e.$set(e.distributeList[e.awardIndex],"awardContent",e.awardRightForm.awardContent),e.$set(e.distributeList[e.awardIndex],"awardContentMarkdown",e.awardRightForm.awardContentMarkdown),e.$set(e.distributeList[e.awardIndex],"status","1"),t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](5),e.$message({message:"分配奖项失败",duration:2e3,type:"error"});case 18:t.next=22;break;case 20:return console.log("设置奖项表单验证失败"),t.abrupt("return",!1);case 22:case"end":return t.stop()}}),t,null,[[5,15]])})));return function(e){return t.apply(this,arguments)}}())},handlePageChange:function(t){this.currentPage=t,this.getDistributeList()},handlePagePrev:function(){this.currentPage--},handlePageNext:function(){this.currentPage++},reset:function(){this.distributeList=[],this.currentPage=1,this.total=0,this.totalRecheck=0,this.awardVisible=!1,this.awardIndex=-1,this.awardLeftForm={},this.awardRightForm={},this.viewVisible=!1,this.viewIndex=-1,this.viewForm={}}}},l=o,c=(a("bda9"),a("0c7c")),d=Object(c["a"])(l,i,r,!1,null,"b457d1ec",null);e["default"]=d.exports},bda9:function(t,e,a){"use strict";a("c18c")},c18c:function(t,e,a){}}]);
//# sourceMappingURL=AwardDistribute.bcca55f8.js.map
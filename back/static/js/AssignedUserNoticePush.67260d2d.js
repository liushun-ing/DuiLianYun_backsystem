(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["AssignedUserNoticePush"],{"008e":function(e,t,i){},aebe:function(e,t,i){"use strict";i("008e")},d93f:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"crumbs"},[i("el-breadcrumb",{attrs:{separator:"/"}},[i("el-breadcrumb-item",[i("i",{staticClass:"el-icon-lx-calendar"}),e._v(" 通知 ")]),i("el-breadcrumb-item",[e._v("指定用户通知")])],1)],1),i("div",{staticClass:"container"},[i("div",{staticClass:"form-box"},[i("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"通知名称",prop:"noticeTitle"}},[i("el-input",{staticStyle:{width:"250px"},model:{value:e.form.noticeTitle,callback:function(t){e.$set(e.form,"noticeTitle",t)},expression:"form.noticeTitle"}})],1),i("el-form-item",{attrs:{label:"通知内容",prop:"noticeContent"}},[i("el-input",{staticClass:"introduction",attrs:{type:"textarea",rows:"5"},model:{value:e.form.noticeContent,callback:function(t){e.$set(e.form,"noticeContent",t)},expression:"form.noticeContent"}})],1),i("el-form-item",{attrs:{label:"选择用户",prop:"totalExpress"}},[i("el-input",{staticStyle:{width:"150px","padding-right":"10px"},attrs:{readonly:""},model:{value:e.form.totalExpress,callback:function(t){e.$set(e.form,"totalExpress",t)},expression:"form.totalExpress"}}),i("el-button",{attrs:{type:"primary",round:""},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v("点击选择用户")])],1),i("el-form-item",{attrs:{label:"通知附件小于10M"}},[i("el-upload",{ref:"uploadFile",staticClass:"file_wrap",attrs:{action:"uploadFileURL","http-request":e.uploadFile,"before-upload":e.beforeFileUpload,limit:1}},[i("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击选择附件")])],1)],1),i("el-form-item",[i("el-button",{staticStyle:{width:"200px"},attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("发送")])],1)],1)],1)]),i("el-dialog",{attrs:{title:"选择用户",visible:e.dialogFormVisible,width:"60%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("div",{staticClass:"drag-box"},[i("div",{staticClass:"to-choose-user"},[i("div",{staticStyle:{"margin-bottom":"20px"}},[i("el-input",{staticStyle:{width:"200px"},attrs:{"prefix-icon":"el-icon-search",placeholder:"请输入关键字"},model:{value:e.inputKey,callback:function(t){e.inputKey=t},expression:"inputKey"}}),i("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.searchUser}},[e._v("搜索")])],1),i("el-table",{ref:"toChooseTable",staticStyle:{width:"100%"},attrs:{height:"300",data:e.userList,"tooltip-effect":"dark","empty-text":"请输入关键字搜索"},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection","min-width":"55"}}),i("el-table-column",{attrs:{prop:"userNickname",label:"昵称","min-width":"120"}}),i("el-table-column",{attrs:{prop:"userName",label:"姓名","min-width":"120"}}),i("el-table-column",{attrs:{label:"会员","min-width":"50"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"===t.row.userType||"3"===t.row.userType?i("div",[i("el-tag",{attrs:{type:"danger"}},[e._v("是")])],1):e._e(),i("div",[i("el-tag",{attrs:{type:"info"}},[e._v("否")])],1)]}}])})],1),i("div",{staticStyle:{"margin-top":"20px","text-align":"right"}},[i("el-button",{attrs:{type:"success",plain:""},on:{click:e.addChosenUser}},[e._v("添加")])],1)],1),i("div",{staticClass:"chosen-user"},[i("div",{staticStyle:{"padding-bottom":"20px","text-align":"center"}},[i("div",{staticClass:"tip_wrap"},[e._v("已选中用户列表")])]),i("el-table",{ref:"chosenTable",staticStyle:{width:"100%"},attrs:{height:"300","empty-text":"还没有用户被选中",data:e.form.noticeUserList,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChangeChosen}},[i("el-table-column",{attrs:{type:"selection","min-width":"55"}}),i("el-table-column",{attrs:{prop:"userNickname",label:"昵称","min-width":"120"}}),i("el-table-column",{attrs:{prop:"userName",label:"姓名","min-width":"120"}}),i("el-table-column",{attrs:{label:"会员","min-width":"50"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"===t.row.userType||"3"===t.row.userType?i("div",[i("el-tag",{attrs:{type:"danger"}},[e._v("是")])],1):e._e(),i("div",[i("el-tag",{attrs:{type:"info"}},[e._v("否")])],1)]}}])})],1),i("div",{staticStyle:{"margin-top":"20px","text-align":"right"}},[i("el-button",{attrs:{type:"danger",plain:""},on:{click:e.cancelChoice}},[e._v("移除选中")])],1)],1)]),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("确 定")])],1)])],1)},r=[],o=(i("ac6a"),i("7f7f"),i("96cf"),i("1da1")),a={name:"AssignedUserNoticePush",data:function(){var e=function(e,t,i){var s=t.lastIndexOf(":"),r=t.slice(s+1);"0"==r?i(new Error("选择用户不能为空")):i()};return{dialogFormVisible:!1,form:{totalExpress:"已选中人数:0",noticeTitle:"",noticeContent:"",attachmentSrc:"",noticeUserList:[]},messageObject:"",chosenUserList:[],multipleSelection:[],multipleSelectionChose:[],inputKey:"",userList:[],rules:{noticeTitle:[{required:!0,message:"请输入通知名称",trigger:"blur"},{min:1,max:10,message:"长度在 1 到 10 个字符"}],noticeContent:[{required:!0,message:"请输入通知内容",trigger:"blur"}],totalExpress:[{required:!0,validator:e,trigger:["blur","change"]}]}}},methods:{uploadFile:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,utils.uploadFile("/user-server/user/uploadPortrait",t.file);case 3:i=e.sent,this.messageObject.close(),this.$set(this.form,"attachmentSrc",i.url),this.$message({message:"文件上传成功",duration:2e3,type:"success"}),e.next=14;break;case 9:e.prev=9,e.t0=e["catch"](0),this.messageObject.close(),console.log(e.t0),this.$message({message:"文件上传失败",duration:2e3,type:"error"});case 14:case"end":return e.stop()}}),e,this,[[0,9]])})));function t(t){return e.apply(this,arguments)}return t}(),beforeFileUpload:function(e){var t=e.name.lastIndexOf("."),i=e.name.slice(t),s=".doc"===i||".pdf"===i||".xls"===i||".xlsx"===i||".docx"===i;if(!s)return this.$message.error("上传文件只能是 doc/docx/pdf/xls/xlsx 格式!"),!1;var r=e.size/1024/1024<10;return r?(this.messageObject=this.$message({message:"上传中",duration:-1}),!0):(this.$message.error("文件大小不能超过10M!"),!1)},searchUser:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.inputKey){e.next=3;break}return this.$message({message:"请先输入搜索关键字",duration:1500,type:"warning"}),e.abrupt("return");case 3:return t={inputKey:this.inputKey},e.prev=4,e.next=7,this.$api.notice.getSearchUsers(t);case 7:i=e.sent,this.userList=i.userList,this.initUserList(),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](4),console.log(e.t0),this.$message({message:"获取用户列表失败，刷新页面",duration:2e3,type:"error"});case 16:case"end":return e.stop()}}),e,this,[[4,12]])})));function t(){return e.apply(this,arguments)}return t}(),initUserList:function(){var e=this;this.userList.forEach((function(t){for(var i=0;i<e.form.noticeUserList.length;i++)if(t.userId===e.form.noticeUserList[i].userId){e.$refs.toChooseTable.toggleRowSelection(t);break}}))},handleSelectionChange:function(e){this.multipleSelection=e},handleSelectionChangeChosen:function(e){this.multipleSelectionChose=e},addChosenUser:function(){var e=this;0!=this.multipleSelection.length?(this.form.noticeUserList=this.form.noticeUserList.concat(this.multipleSelection),this.multipleSelection.forEach((function(t,i){for(var s=0;s<e.userList.length;s++)if(e.userList[s].userId===t.userId){e.userList.splice(s,1);break}})),this.multipleSelection=[],this.form.totalExpress="已选中人数:"+this.form.noticeUserList.length):this.$message("请先选中用户")},cancelChoice:function(){var e=this;0!=this.multipleSelectionChose?(this.userList=this.userList.concat(this.multipleSelectionChose),this.multipleSelectionChose.forEach((function(t,i){for(var s=0;s<e.form.noticeUserList.length;s++)if(e.form.noticeUserList[s].userId===t.userId){e.form.noticeUserList.splice(s,1);break}})),this.multipleSelectionChose=[],this.form.totalExpress="已选中人数:"+this.form.noticeUserList.length):this.$message("请先选中用户")},uploadNoticeData:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t=[],this.form.noticeUserList.forEach((function(e){t.push(e.userId)})),i={noticeTitle:this.form.noticeTitle,noticeContent:this.form.noticeContent,attachmentSrc:this.form.attachmentSrc,noticeUserList:t},e.next=6,this.$api.notice.noticeSomeUsers(i);case 6:this.$message({message:"通知发送成功",duration:2e3,type:"success"}),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](0),this.$message({message:"通知发送失败",duration:2e3,type:"error"});case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));function t(){return e.apply(this,arguments)}return t}(),onSubmit:function(){var e=this;this.$refs["form"].validate((function(t){if(!t)return!1;e.uploadNoticeData(),e.$refs.uploadFile.clearFiles(),e.reset()}))},reset:function(){this.dialogFormVisible=!1,this.form={noticeTitle:"",noticeContent:"",noticeUserList:[],attachmentSrc:"",totalExpress:"已选中人数:0"},this.multipleSelection=[],this.multipleSelectionChose=[],this.inputKey="",this.userList=[],this.$refs["form"].clearValidate()}}},n=a,l=(i("aebe"),i("0c7c")),c=Object(l["a"])(n,s,r,!1,null,"7eda3a7c",null);t["default"]=c.exports}}]);
//# sourceMappingURL=AssignedUserNoticePush.67260d2d.js.map
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["SecondReview"],{4723:function(e,t,a){},"67a0":function(e,t,a){"use strict";a("4723")},f04f:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-lx-cascades"}),e._v(" 二审投稿 ")])],1)],1),a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[e._v("\n            请先选择比赛: \n            "),a("el-select",{ref:"select",attrs:{placeholder:"请选择比赛"},on:{change:e.handleSelected},model:{value:e.selectedCompetitionId,callback:function(t){e.selectedCompetitionId=t},expression:"selectedCompetitionId"}},e._l(e.competitionList,(function(e){return a("el-option",{key:e.competitionId,attrs:{label:e.competitionName,value:e.competitionId}})})),1),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-refresh"},on:{click:e.handleRefresh}},[e._v("刷新")])],1),a("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:e.displayManuscriptList,border:"","header-cell-class-name":"table-header"}},[a("el-table-column",{attrs:{label:"投稿内容",align:"center","min-width":"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"limit_wrap"},[e._v(e._s(t.row.manuscriptContent))])]}}])}),a("el-table-column",{attrs:{label:"一审分数",align:"center","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[-1!=t.row.score?a("div",[e._v(e._s(t.row.firstScore))]):e._e()]}}])}),a("el-table-column",{attrs:{label:"一审评语",align:"center","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"limit_wrap"},[e._v(e._s(t.row.firstComment))])]}}])}),a("el-table-column",{attrs:{prop:"manuscriptCreateTime",label:"投稿时间",width:"160",sortable:""}}),a("el-table-column",{attrs:{label:"二审分数",align:"center","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[-1!=t.row.secondScore?a("div",[e._v(e._s(t.row.secondScore))]):e._e()]}}])}),a("el-table-column",{attrs:{label:"二审评语",prop:"secondComment",align:"center","min-width":"200"}}),a("el-table-column",{attrs:{label:"操作",width:"100",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[-1==t.row.secondScore?a("el-button",{staticClass:"blue",attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handleReview(t.$index,t.row)}}},[e._v("作品评审")]):a("el-button",{staticClass:"blue",attrs:{disabled:"",type:"text",icon:"el-icon-edit"}},[e._v("已评审")])]}}])})],1),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":e.currentPage,"page-size":e.pageSize,total:e.total},on:{"current-change":e.handlePageChange,"prev-click":e.handlePagePrev,"next-click":e.handlePageNext}})],1)],1),a("el-dialog",{ref:"dialog",attrs:{title:"作品评审",visible:e.dialogFormVisible,showClose:!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticStyle:{display:"flex","align-content":"space-around"}},[a("div",{staticClass:"manuscript-content-box"},[a("el-form",{attrs:{model:e.manuscriptData}},[a("el-form-item",{attrs:{label:"作品内容:"}},[a("el-input",{attrs:{readonly:"",type:"textarea",rows:"8"},model:{value:e.manuscriptData.manuscriptContent,callback:function(t){e.$set(e.manuscriptData,"manuscriptContent",t)},expression:"manuscriptData.manuscriptContent"}})],1),a("el-form-item",{attrs:{label:"一审评价:"}},[a("el-input",{attrs:{readonly:"",type:"textarea",rows:"8"},model:{value:e.manuscriptData.firstComment,callback:function(t){e.$set(e.manuscriptData,"firstComment",t)},expression:"manuscriptData.firstComment"}})],1),a("el-form-item",{attrs:{label:"一审得分:"}},[a("el-input",{attrs:{type:"text",readonly:""},model:{value:e.manuscriptData.firstScore,callback:function(t){e.$set(e.manuscriptData,"firstScore",t)},expression:"manuscriptData.firstScore"}})],1)],1)],1),a("div",{staticClass:"review-box"},[a("el-form",{ref:"review",attrs:{model:e.reviewData,rules:e.rules}},[a("el-form-item",{attrs:{label:"评分:",prop:"score"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入评分"},model:{value:e.reviewData.score,callback:function(t){e.$set(e.reviewData,"score",t)},expression:"reviewData.score"}})],1),a("el-form-item",{attrs:{label:"评论:",prop:"comment"}},[a("el-input",{attrs:{type:"textarea",rows:"5",placeholder:"请输入评论"},model:{value:e.reviewData.comment,callback:function(t){e.$set(e.reviewData,"comment",t)},expression:"reviewData.comment"}})],1)],1)],1)]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v("确 定")])],1)])],1)},i=[],r=(a("96cf"),a("1da1")),s=(a("55dd"),a("fa7d")),o={name:"SecondReview",data:function(){var e=function(e,t,a){return t?t<0||t>100?a(new Error("分数应该在0~100")):void a():a(new Error("请输入评审分数"))};return{selectedCompetitionId:"",dialogFormVisible:!1,competitionList:[],currentPage:1,total:0,pageSize:10,manuscriptList:[],displayManuscriptList:[],manuscriptData:{},reviewData:{reviewerId:"",manuscriptId:"",score:"",comment:""},rules:{score:[{required:!0,message:"请输入评分",trigger:"blur"},{validator:e,trigger:"blur"}],comment:[{required:!0,message:"请输入评论",trigger:"blur"}]}}},activated:function(){this.getAllCompetition()},methods:{sortByTime:function(e){return e.sort((function(e,t){var a=new Date(e.createTime).getTime(),n=new Date(t.createtime).getTime();return a>n?-1:a<n?1:0}))},getAllCompetition:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$api.competition.getAllCompetition();case 3:t=e.sent,this.competitionList=this.sortByTime(t.competitionList),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}(),getSecondReviewManuscript:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={adminId:s["a"].getSessionInfo("adminId"),competitionId:this.selectedCompetitionId},e.prev=1,e.next=4,this.$api.competition.getManuscriptSecond(t);case 4:a=e.sent,a.isOver?(this.manuscriptList=a.manuscriptList,this.total=this.manuscriptList.length,this.currentPage=1,this.changePageContent()):this.$message({type:"info",message:"二审尚未开始!"}),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](1),this.$message({message:"获取投稿失败",duration:2e3,type:"error"}),console.log(e.t0);case 12:case"end":return e.stop()}}),e,this,[[1,8]])})));function t(){return e.apply(this,arguments)}return t}(),handlePageChange:function(e){this.currentPage=e,this.changePageContent()},handlePagePrev:function(){this.currentPage--},handlePageNext:function(){this.currentPage++},changePageContent:function(){this.displayManuscriptList=this.manuscriptList.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize>=this.manuscriptList.length?this.manuscriptList.length:this.currentPage*this.pageSize)},handleReview:function(e,t){this.manuscriptData=JSON.parse(JSON.stringify(t)),this.dialogFormVisible=!0},handleCancel:function(){var e=this;this.$confirm("取消将不保存已填写的内容，是否继续?","提示",{confirmButttonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.dialogFormVisible=!1,e.$message({message:"操作已取消",duration:1500,type:"error"}),e.reviewData={reviewerId:"",manuscriptId:"",score:"",comment:""}})).catch((function(){}))},handleSelected:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.currentPage=1,this.getSecondReviewManuscript();case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),handleRefresh:function(){var e=this.$message("刷新中");this.currentPage=1,this.getSecondReviewManuscript(),this.reviewData={reviewerId:"",comment:"",score:"",manuscriptId:""},e.close()},handleConfirm:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$refs["review"].validate(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(a){var n,i,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=20;break}return t.dialogFormVisible=!1,t.reviewData.reviewerId=s["a"].getSessionInfo("adminId"),t.reviewData.manuscriptId=t.manuscriptData.manuscriptId,n=t.reviewData,e.prev=5,e.next=8,t.$api.competition.uploadReviewDataSecond(n);case 8:for(t.$message({message:"评审成功",duration:2e3,type:"success"}),i=0;i<t.displayManuscriptList.length;i++)t.displayManuscriptList[i].manuscriptId===t.reviewData.manuscriptId&&(t.displayManuscriptList[i].secondScore=1*t.reviewData.score,t.$set(t.displayManuscriptList[i],"secondComment",t.reviewData.comment));for(r=0;r<t.manuscriptList.length;r++)t.manuscriptList[r].manuscriptId===t.reviewData.manuscriptId&&(t.manuscriptList[r].secondScore=1*t.reviewData.score,t.$set(t.manuscriptList[r],"secondComment",t.reviewData.comment));t.reviewData={reviewerId:"",comment:"",score:"",manuscriptId:""},e.next=18;break;case 14:e.prev=14,e.t0=e["catch"](5),t.$message({message:"评审失败",duration:2e3,type:"error"}),console.log(e.t0);case 18:e.next=21;break;case 20:t.$message({message:"请先填写评分和评论",duration:2e3,type:"warning"});case 21:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},c=o,l=(a("67a0"),a("0c7c")),u=Object(l["a"])(c,n,i,!1,null,null,null);t["default"]=u.exports}}]);
//# sourceMappingURL=SecondReview.5fe4cc4b.js.map
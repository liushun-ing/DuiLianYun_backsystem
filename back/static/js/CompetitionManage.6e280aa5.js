(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["CompetitionManage"],{"10f3":function(e,t,i){},"5d6f":function(e,t,i){"use strict";i("10f3")},dabc:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"crumbs"},[i("el-breadcrumb",{attrs:{separator:"/"}},[i("el-breadcrumb-item",[i("i",{staticClass:"el-icon-lx-cascades"}),e._v(" 比赛管理 ")])],1)],1),i("div",{staticClass:"container"},[i("div",{staticClass:"handle-box"},[i("el-input",{staticClass:"handle-input mr10",attrs:{placeholder:"比赛名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch(t)}},model:{value:e.inputKey,callback:function(t){e.inputKey=t},expression:"inputKey"}}),i("el-button",{attrs:{type:"primary",icon:"el-icon-refresh"},on:{click:e.handleRefresh}},[e._v("刷新")]),i("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("搜索")]),i("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleAdd}},[e._v("新增")])],1),i("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:e.competitionList,border:"","header-cell-class-name":"table-header"}},[i("el-table-column",{attrs:{prop:"competitionName","min-width":"200",label:"比赛名称",align:"center"}}),i("el-table-column",{attrs:{prop:"competitionStartDate",width:"160",label:"比赛开始时间",align:"center",sortable:""}}),i("el-table-column",{attrs:{prop:"competitionEndDate",width:"160",label:"比赛结束时间",align:"center",sortable:""}}),i("el-table-column",{attrs:{prop:"levyStartDate",width:"160",label:"投稿开始时间",align:"center",sortable:""}}),i("el-table-column",{attrs:{prop:"levyEndDate",width:"160",label:"投稿结束时间",align:"center",sortable:""}}),i("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(i){return e.handleEdit(t.$index,t.row)}}},[e._v("查看/修改")]),i("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(i){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),i("div",{staticClass:"pagination"},[i("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":e.currentPage,"page-size":e.pageSize,total:e.total},on:{"current-change":e.handlePageChange,"prev-click":e.handlePagePrev,"next-click":e.handlePageNext}})],1)],1),i("el-dialog",{attrs:{title:"编辑",visible:e.editVisible,width:"80%","show-close":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editVisible=t}}},[i("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.rules,"label-width":"120px"}},[i("el-form-item",{attrs:{label:"活动名称",prop:"competitionName"}},[i("el-input",{model:{value:e.editForm.competitionName,callback:function(t){e.$set(e.editForm,"competitionName",t)},expression:"editForm.competitionName"}})],1),i("el-form-item",{attrs:{label:"封面图片最优宽高2:1",prop:"competitionImage"}},[i("el-upload",{ref:"upload",staticClass:"cm-avatar-uploader",attrs:{action:"uploadURL","show-file-list":!1,limit:1,"http-request":e.uploadPicture,"before-upload":e.beforeAvatarUpload}},[e.editForm.competitionImage?i("el-image",{staticClass:"cm-avatar",attrs:{src:e.editForm.competitionImage,fit:"contain"}}):i("i",{staticClass:"el-icon-plus cm-avatar-uploader-icon"})],1)],1),i("el-form-item",{attrs:{label:"活动简介",prop:"competitionIntroduction"}},[i("mavon-editor",{ref:"md",attrs:{toolbars:e.toolbars,autofocus:!1},on:{imgAdd:e.$imgAdd,imgDel:e.$imgDel},model:{value:e.editForm.competitionIntroduction,callback:function(t){e.$set(e.editForm,"competitionIntroduction",t)},expression:"editForm.competitionIntroduction"}})],1),i("el-form-item",{attrs:{label:"比赛起止时间",required:""}},[i("el-col",{attrs:{span:11}},[i("el-form-item",{attrs:{prop:"competitionStartDate"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择开始时间"},model:{value:e.editForm.competitionStartDate,callback:function(t){e.$set(e.editForm,"competitionStartDate",t)},expression:"editForm.competitionStartDate"}})],1)],1),i("el-col",{staticStyle:{"text-align":"center"},attrs:{span:2}},[e._v("-")]),i("el-col",{attrs:{span:11}},[i("el-form-item",{attrs:{prop:"competitionEndDate"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择结束时间"},model:{value:e.editForm.competitionEndDate,callback:function(t){e.$set(e.editForm,"competitionEndDate",t)},expression:"editForm.competitionEndDate"}})],1)],1)],1),i("el-form-item",{attrs:{label:"投稿起止时间",required:""}},[i("el-col",{attrs:{span:11}},[i("el-form-item",{attrs:{prop:"levyStartDate"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择开始时间"},model:{value:e.editForm.levyStartDate,callback:function(t){e.$set(e.editForm,"levyStartDate",t)},expression:"editForm.levyStartDate"}})],1)],1),i("el-col",{staticStyle:{"text-align":"center"},attrs:{span:2}},[e._v("-")]),i("el-col",{attrs:{span:11}},[i("el-form-item",{attrs:{prop:"levyStartDate"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择结束时间"},model:{value:e.editForm.levyEndDate,callback:function(t){e.$set(e.editForm,"levyEndDate",t)},expression:"editForm.levyEndDate"}})],1)],1)],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.cancelEdit}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.saveEdit("editForm")}}},[e._v("确 定")])],1)],1)],1)},r=[],n=(i("96cf"),i("1da1")),o=i("fa7d"),s={name:"CompetitionManage",data:function(){return{toolbars:o["a"].toolbars,inputKey:"",competitionList:[],currentPage:1,total:0,pageSize:10,editForm:{},editIndex:-1,editVisible:!1,rules:{competitionName:[{required:!0,message:"请输入活动名称",trigger:"blur"}],competitionIntroduction:[{required:!0,message:"请输入活动简介",trigger:"blur"}],competitionStartDate:[{required:!0,message:"请选择比赛开始时间",trigger:"blur"}],competitionEndDate:[{required:!0,message:"请选择比赛结束时间",trigger:"blur"}],levyStartDate:[{required:!0,message:"请选择投稿开始时间",trigger:"blur"}],levyEndDate:[{required:!0,message:"请选择投稿结束时间",trigger:"blur"}]}}},activated:function(){this.currentPage=1,this.inputKey="",this.getCompetitionList()},methods:{$imgAdd:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,i){var a,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a="image/jpeg"===i.type||"image/png"===i.type,a?this.$message({message:"上传中",duration:1e3,type:"info"}):this.$message.error("上传封面图片只能是 JPG或者PNG 格式!"),a){e.next=4;break}return e.abrupt("return");case 4:return r=this.$message({message:"正在上传中...",type:"info",duration:0}),e.prev=5,e.next=8,o["a"].uploadFile("/post-server/manuscript/upload",i);case 8:n=e.sent,this.$refs.md.$img2Url(t,n.url),r.close(),this.$message({message:"图片上传成功",duration:2e3,type:"success"}),e.next=19;break;case 14:e.prev=14,e.t0=e["catch"](5),r.close(),this.$message({message:"图片上传失败",duration:2e3,type:"error"}),console.log(e.t0);case 19:case"end":return e.stop()}}),e,this,[[5,14]])})));function t(t,i){return e.apply(this,arguments)}return t}(),$imgDel:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,i){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={url:t[0]},e.prev=1,e.next=4,this.$api.news.deleteImage(a);case 4:console.log("比赛简介内容图片删除成功"),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](1),console.log("比赛简介内容图片删除失败"),console.log(e.t0);case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));function t(t,i){return e.apply(this,arguments)}return t}(),getCompetitionList:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={currentPage:this.currentPage,pageSize:this.pageSize,inputKey:this.inputKey},e.prev=1,e.next=4,this.$api.competition.getCompetitionList(t);case 4:i=e.sent,this.competitionList=i.competitionList,this.total=i.total,e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](1),this.$message({message:"获取比赛列表失败",duration:2e3,type:"error"}),console.log(e.t0);case 13:case"end":return e.stop()}}),e,this,[[1,9]])})));function t(){return e.apply(this,arguments)}return t}(),handleRefresh:function(){var e=this.$message("刷新中");this.currentPage=1,this.inputKey="",this.getCompetitionList(),e.close()},handleSearch:function(){this.currentPage=1,this.getCompetitionList()},handlePageChange:function(e){this.currentPage=e,this.getCompetitionList()},handlePagePrev:function(){this.currentPage--},handlePageNext:function(){this.currentPage++},handleDelete:function(e,t){var i=this;this.$confirm("该比赛将永久删除，确定要继续吗？","提示",{type:"warning"}).then(Object(n["a"])(regeneratorRuntime.mark((function e(){var a,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.competitionImage,r={competitionId:t.competitionId},e.prev=2,e.next=5,i.$api.competition.deleteCompetition(r);case 5:if(i.$message({message:"删除比赛成功",duration:2e3,type:"success"}),!a){e.next=17;break}return n={url:a},e.prev=8,e.next=11,i.$api.news.deleteImage(n);case 11:console.log("删除比赛封面图片成功"),e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](8),console.log("删除比赛封面图片失败");case 17:i.getCompetitionList(),e.next=24;break;case 20:e.prev=20,e.t1=e["catch"](2),i.$message({message:"删除失败",duration:2e3,type:"error"}),console.log(e.t1);case 24:case"end":return e.stop()}}),e,null,[[2,20],[8,14]])})))).catch((function(){i.$message({message:"操作已取消",duration:1500,type:"info"})}))},uploadPicture:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o["a"].uploadFile("/post-server/manuscript/upload",t.file);case 3:i=e.sent,this.$set(this.editForm,"competitionImage",i.url),this.$message({message:"图片上传成功",duration:2e3,type:"success"}),this.$refs.upload.clearFiles(),e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](0),console.log(e.t0),this.$message({message:"图片上传失败",duration:2e3,type:"error"});case 13:case"end":return e.stop()}}),e,this,[[0,9]])})));function t(t){return e.apply(this,arguments)}return t}(),beforeAvatarUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type;return t?this.$message({message:"上传中",duration:1e3,type:"info"}):this.$message.error("上传封面图片只能是 JPG或者PNG 格式!"),t},handleEdit:function(e,t){this.editIndex=e,this.editForm=JSON.parse(JSON.stringify(t)),this.editVisible=!0},cancelEdit:function(){this.editVisible=!1,this.$message({message:"操作已取消",duration:1500,type:"info"}),this.$refs["editForm"].clearValidate()},saveEdit:function(e){var t=this;this.$refs[e].validate(function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(i){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!i){e.next=18;break}if(a={competitionId:t.editForm.competitionId,competitionName:t.editForm.competitionName,competitionImage:t.editForm.competitionImage,competitionIntroduction:t.editForm.competitionIntroduction,competitionStartDate:t.editForm.competitionStartDate,competitionEndDate:t.editForm.competitionEndDate,levyStartDate:t.editForm.levyStartDate,levyEndDate:t.editForm.levyEndDate},o["a"].compareCompetitionDate(a.competitionStartDate,a.competitionEndDate,a.levyStartDate,a.levyEndDate)){e.next=4;break}return e.abrupt("return",!1);case 4:return t.editVisible=!1,e.prev=5,e.next=8,t.$api.competition.modifyCompetition(a);case 8:t.$message({message:"修改成功",duration:2e3,type:"success"}),t.$set(t.competitionList,t.editIndex,t.editForm),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](5),t.$message({message:"修改失败",duration:2e3,type:"error"}),console.log(e.t0);case 16:e.next=20;break;case 18:return console.log("修改比赛表单验证失败"),e.abrupt("return",!1);case 20:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(t){return e.apply(this,arguments)}}())},handleAdd:function(){this.$router.push({name:"CompetitionRelease"})}}},l=s,c=(i("5d6f"),i("0c7c")),m=Object(c["a"])(l,a,r,!1,null,null,null);t["default"]=m.exports}}]);
//# sourceMappingURL=CompetitionManage.6e280aa5.js.map
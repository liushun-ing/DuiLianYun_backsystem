(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["UserManage"],{"3cf6":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"crumbs"},[s("el-breadcrumb",{attrs:{separator:"/"}},[s("el-breadcrumb-item",[s("i",{staticClass:"el-icon-lx-cascades"}),e._v(" 所有用户管理 ")])],1)],1),s("div",{staticClass:"container"},[s("div",{staticClass:"handle-box"},[s("el-input",{staticClass:"handle-input mr10",attrs:{placeholder:"昵称/姓名/电话号码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch(t)}},model:{value:e.inputKey,callback:function(t){e.inputKey=t},expression:"inputKey"}}),s("el-button",{attrs:{type:"primary",icon:"el-icon-refresh"},on:{click:e.handleRefresh}},[e._v("刷新")]),s("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("搜索")])],1),s("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:e.userList,border:"","header-cell-class-name":"table-header"}},[s("el-table-column",{attrs:{prop:"userNickname",label:"昵称","min-width":"120",align:"center"}}),s("el-table-column",{attrs:{prop:"userName",label:"姓名","min-width":"100",align:"center"}}),s("el-table-column",{attrs:{label:"头像(查看大图)","min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[s("el-image",{staticClass:"table-td-thumb",attrs:{src:e.row.userPortrait,"preview-src-list":[e.row.userPortrait]}})]}}])}),s("el-table-column",{attrs:{prop:"userPhone","min-width":"130",label:"电话",align:"center"}}),s("el-table-column",{attrs:{label:"类型","min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.userType?s("el-tag",{staticStyle:{display:"block"},attrs:{type:"info"}},[e._v("普通用户")]):1===t.row.userType?s("el-tag",{staticStyle:{display:"block"},attrs:{type:"warning"}},[e._v("协会会员")]):2===t.row.userType?s("el-tag",{staticStyle:{display:"block"},attrs:{type:"warning"}},[e._v("楹联家")]):3===t.row.userType?s("el-tag",{staticStyle:{display:"block"},attrs:{type:"danger"}},[e._v("会员&楹联家")]):e._e()]}}])}),s("el-table-column",{attrs:{label:"职称","min-width":"130",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",[null===t.row.userDuty?s("el-tag",{attrs:{type:"info"}},[e._v("暂无")]):s("el-tag",{attrs:{type:"warning"}},[e._v(e._s(t.row.userDuty))])],1)]}}])}),s("el-table-column",{attrs:{label:"状态","min-width":"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:0===t.row.userIsDisable?"success":"danger"}},[e._v(e._s(0===t.row.userIsDisable?"正常":"禁用"))])]}}])}),s("el-table-column",{attrs:{prop:"userLoginTime","min-width":"160",label:"注册时间",align:"center"}}),s("el-table-column",{attrs:{label:"操作","min-width":"220",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.userIsDisable?s("div",[s("el-button",{staticClass:"green",attrs:{type:"text",icon:"el-icon-view"},on:{click:function(s){return e.handleViewDetails(t.row)}}},[e._v("查看")]),s("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-circle-close"},on:{click:function(s){return e.handleDisable(t.$index,t.row)}}},[e._v("禁用")]),0===t.row.userType||1===t.row.userType?s("el-button",{staticStyle:{color:"orange"},attrs:{type:"text",icon:"el-icon-s-promotion"},on:{click:function(s){return e.handlePromote(t.$index,t.row)}}},[e._v("设为楹联家")]):s("el-button",{staticStyle:{color:"rgb(144, 147, 153)"},attrs:{disabled:"",type:"text",icon:"el-icon-s-promotion"}},[e._v("已为楹联家")]),s("el-button",{staticStyle:{color:"rgb(13, 147, 224)"},attrs:{type:"text",icon:"el-icon-user"},on:{click:function(s){return e.handleSetDuty(t.$index,t.row)}}},[e._v("设置职务")]),s("el-button",{staticStyle:{color:"rgb(128, 128, 0)"},attrs:{type:"text",icon:"el-icon-s-comment"},on:{click:function(s){return e.handleSendNotice(t.$index,t.row)}}},[e._v("发通知")])],1):s("div",[s("el-button",{staticClass:"green",attrs:{type:"text",icon:"el-icon-view"},on:{click:function(s){return e.handleViewDetsails(t.row)}}},[e._v("查看")]),s("el-button",{staticClass:"yellowgreen",attrs:{type:"text",icon:"el-icon-circle-check"},on:{click:function(s){return e.handleDisable(t.$index,t.row)}}},[e._v("启用")]),0===t.row.userType||1===t.row.userType?s("el-button",{staticStyle:{color:"orange"},attrs:{type:"text",icon:"el-icon-s-promotion"},on:{click:function(s){return e.handlePromote(t.$index,t.row)}}},[e._v("设为楹联家")]):s("el-button",{staticStyle:{color:"rgb(144, 147, 153)"},attrs:{disabled:"",type:"text",icon:"el-icon-s-promotion"}},[e._v("已为楹联家")]),s("el-button",{staticStyle:{color:"rgb(13, 147, 224)"},attrs:{type:"text",icon:"el-icon-user"},on:{click:function(s){return e.handleSetDuty(t.$index,t.row)}}},[e._v("设置职务")]),s("el-button",{staticStyle:{color:"rgb(255, 255, 0)"},attrs:{type:"text",icon:"el-icon-s-comment"},on:{click:function(s){return e.handleSendNotice(t.$index,t.row)}}},[e._v("发通知")])],1)]}}])})],1),s("div",{staticClass:"pagination"},[s("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":e.currentPage,"page-size":e.pageSize,total:e.total},on:{"current-change":e.handlePageChange,"prev-click":e.handlePagePrev,"next-click":e.handlePageNext}})],1)],1),s("el-dialog",{attrs:{visible:e.dialogInfoVisible,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogInfoVisible=t}}},[s("el-descriptions",{attrs:{title:"用户信息",direction:"vertical",column:3,border:"",size:"medium"}},[s("el-descriptions-item",{attrs:{label:"昵称",span:1}},[e._v(e._s(e.chosenUser.userNickname))]),s("el-descriptions-item",{attrs:{label:"姓名",span:1}},[e._v(e._s(e.chosenUser.userName))]),s("el-descriptions-item",{attrs:{label:"系统职称",span:1}},[e._v(e._s(e.chosenUser.userDuty))]),s("el-descriptions-item",{attrs:{label:"手机号",span:1}},[e._v(e._s(e.chosenUser.userPhone))]),s("el-descriptions-item",{attrs:{label:"居住地",span:2}},[e._v(e._s(e.chosenUser.userLocation))]),s("el-descriptions-item",{attrs:{label:"出生日期",span:1}},[e._v(e._s(e.chosenUser.userBirthday))]),s("el-descriptions-item",{attrs:{label:"邮箱地址",span:1}},[e._v(e._s(e.chosenUser.userEmail))]),s("el-descriptions-item",{attrs:{label:"注册日期",span:1}},[e._v(e._s(e.chosenUser.userLoginTime))]),s("el-descriptions-item",{attrs:{label:"座右铭",span:1}},[e._v(e._s(e.chosenUser.userMotto))]),s("el-descriptions-item",{attrs:{label:"个人简介",span:2}},[e._v(e._s(e.chosenUser.userIntroduction))])],1)],1),s("el-dialog",{attrs:{title:"提示",visible:e.promoteVisible,width:"40%","show-close":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.promoteVisible=t}}},[s("div",{staticStyle:{"font-size":"18px","font-weight":"600","padding-bottom":"30px"}},[e._v("该用户将设置为楹联家，确定要继续吗？")]),s("el-checkbox",{model:{value:e.isSendNotice,callback:function(t){e.isSendNotice=t},expression:"isSendNotice"}},[e._v("是否自动发送如下通知")]),s("el-descriptions",{staticStyle:{"padding-top":"10px"},attrs:{column:1,border:""}},[s("el-descriptions-item",{attrs:{label:"通知标题"}},[e._v(e._s(e.noticeForm.noticeTitle))]),s("el-descriptions-item",{attrs:{label:"通知内容"}},[e._v(e._s(e.noticeForm.noticeContent))])],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:e.cancelPromote}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.savePromote}},[e._v("确 定")])],1)],1),s("el-dialog",{attrs:{title:"提示",visible:e.setDutyVisible,width:"40%","show-close":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.setDutyVisible=t}}},[s("div",{staticStyle:{"font-size":"18px","font-weight":"600","padding-bottom":"30px"}},[e._v("请输入用户职称(只能设置单个职称)")]),s("el-input",{attrs:{placeholder:"请输入职称",maxlength:"15"},model:{value:e.inputDuty,callback:function(t){e.inputDuty=t},expression:"inputDuty"}},[e._v(e._s(this.setDutyForm.userDuty))]),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:e.cancelSetDuty}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.saveSetDuty}},[e._v("确 定")])],1)],1),s("el-dialog",{attrs:{title:"提示",visible:e.noticeVisible,width:"40%","show-close":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.noticeVisible=t}}},[s("div",{staticStyle:{"font-size":"18px","font-weight":"600","padding-bottom":"30px"}},[e._v("请输入通知标题(不要过长)")]),s("el-input",{attrs:{placeholder:"请输入通知标题",maxlength:"15"},model:{value:e.noticeTitle,callback:function(t){e.noticeTitle=t},expression:"noticeTitle"}}),s("div",{staticStyle:{"font-size":"18px","font-weight":"600","padding-bottom":"30px","padding-top":"30px"}},[e._v("请输入通知内容")]),s("el-input",{attrs:{type:"textarea",placeholder:"请输入通知内容"},model:{value:e.noticeContent,callback:function(t){e.noticeContent=t},expression:"noticeContent"}}),s("div",{staticStyle:{"font-size":"18px","font-weight":"600","padding-bottom":"30px","padding-top":"30px"}},[e._v("\n            如有需要，可以选择附件(doc,pdf,xls)\n        ")]),s("el-upload",{ref:"uploadFile",staticClass:"file_wrap",attrs:{action:"uploadFileURL","http-request":e.uploadFile,"before-upload":e.beforeFileUpload,limit:1}},[s("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击选择附件")])],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:e.cancelSendNotice}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.saveSendNotice}},[e._v("确 定")])],1)],1)],1)},n=[],r=(s("7f7f"),s("ac6a"),s("96cf"),s("1da1")),o=s("ade3"),a=s("fa7d"),c={name:"UserManage",data:function(){var e;return e={inputKey:"",userList:[],currentPage:1,pageSize:10,total:0,promoteVisible:!1,promoteIndex:-1,promoteForm:{},setDutyVisible:!1,inputDuty:"",setDutyIndex:-1,setDutyForm:{},noticeVisible:!1,noticeTitle:"",noticeContent:"",attachmentSrc:"",noticeIndex:-1,noticeForm:{},isSendNotice:!0},Object(o["a"])(e,"noticeForm",""),Object(o["a"])(e,"chosenUser",{}),Object(o["a"])(e,"dialogInfoVisible",!1),e},activated:function(){this.noticeForm=a["a"].getNoticeTemplate(0),this.currentPage=1,this.inputKey="",this.getUserList()},methods:{getUserList:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={currentPage:this.currentPage,pageSize:this.pageSize,inputKey:this.inputKey},e.prev=1,e.next=4,this.$api.user.getUserList(t);case 4:s=e.sent,s.userList.forEach((function(e){e.userLoginTime=(e.userLoginTime+"").slice(0,19)})),this.userList=s.userList,this.total=s.total,e.next=14;break;case 10:e.prev=10,e.t0=e["catch"](1),this.$message({message:"获取用户列表失败",duration:2e3,type:"error"}),console.log(e.t0);case 14:case"end":return e.stop()}}),e,this,[[1,10]])})));function t(){return e.apply(this,arguments)}return t}(),handleRefresh:function(){var e=this.$message("刷新中");this.currentPage=1,this.inputKey="",this.getUserList(),e.close()},handleSearch:function(){this.currentPage=1,this.getUserList()},handlePageChange:function(e){this.currentPage=e,this.getUserList()},handlePagePrev:function(){this.currentPage--},handlePageNext:function(){this.currentPage++},handlePromote:function(e,t){this.promoteVisible=!0,this.promoteIndex=e,this.promoteForm=JSON.parse(JSON.stringify(t)),this.isSendNotice=!0},savePromote:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.promoteVisible=!1,t={masterName:this.promoteForm.userName,masterDynasty:"当代",masterIntroduction:this.promoteForm.userIntroduction,masterPhoto:this.promoteForm.userPortrait,masterBindedUserId:this.promoteForm.userId},e.prev=2,e.next=5,this.$api.user.promoteUser(t);case 5:this.$message({message:"设置楹联家成功",duration:2e3,type:"success"}),this.userList[this.promoteIndex].userType=0===this.promoteForm.userType?2:3,this.isSendNotice&&setTimeout((function(){a["a"].sendNotice(s.promoteForm.userId,0)}),1e3),e.next=14;break;case 10:e.prev=10,e.t0=e["catch"](2),this.$message({message:"设置楹联家失败",duration:2e3,type:"error"}),console.log(e.t0);case 14:case"end":return e.stop()}}),e,this,[[2,10]])})));function t(){return e.apply(this,arguments)}return t}(),cancelPromote:function(){this.promoteVisible=!1,this.$message({message:"操作已取消",duration:1500,type:"info"}),this.$refs["promoteForm"].clearValidate()},handleSetDuty:function(e,t){this.setDutyVisible=!0,this.setDutyIndex=e,this.setDutyForm=JSON.parse(JSON.stringify(t))},cancelSetDuty:function(){this.setDutyVisible=!1,this.$message({message:"操作已取消",duration:1500,type:"info"})},uploadFile:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a["a"].uploadFile("/user-server/user/uploadPortrait",t.file);case 3:s=e.sent,this.messageObject.close(),this.attachmentSrc=s.url,this.$message({message:"文件上传成功",duration:2e3,type:"success"}),e.next=13;break;case 8:e.prev=8,e.t0=e["catch"](0),this.messageObject.close(),console.log(e.t0),this.$message({message:"文件上传失败",duration:2e3,type:"error"});case 13:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(t){return e.apply(this,arguments)}return t}(),beforeFileUpload:function(e){var t=e.name.lastIndexOf("."),s=e.name.slice(t),i=".doc"===s||".pdf"===s||".xls"===s||".xlsx"===s||".docx"===s;if(!i)return this.$message.error("上传文件只能是 doc/docx/pdf/xls/xlsx 格式!"),!1;var n=e.size/1024/1024<10;return n?(this.messageObject=this.$message({message:"上传中",duration:-1}),!0):(this.$message.error("文件大小不能超过10M!"),!1)},handleSendNotice:function(e,t){this.noticeTitle="",this.noticeContent="",this.noticeVisible=!0,this.noticeIndex=e,this.noticeForm=JSON.parse(JSON.stringify(t))},cancelSendNotice:function(){this.noticeVisible=!1,this.noticeTitle="",this.noticeContent="",this.$message({message:"操作已取消",duration:1500,type:"info"})},saveSendNotice:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.noticeTitle&&this.noticeContent){e.next=4;break}this.$message({message:"请先输入标题和内容",type:"warning",duration:2e3}),e.next=13;break;case 4:return this.noticeVisible=!1,this.noticeContent=this.noticeForm.userName+"您好。"+this.noticeContent,e.next=8,a["a"].sendNotice(this.noticeForm.userId,11,this.noticeTitle,this.noticeContent,this.attachmentSrc);case 8:t=e.sent,"发送成功"===t&&this.$message.success("发送成功"),this.noticeTitle="",this.noticeContent="",this.$refs.uploadFile.clearFiles();case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),saveSetDuty:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={userId:this.userList[this.setDutyIndex].userId,userDuty:this.inputDuty},e.prev=1,e.next=4,this.$api.user.setUserDuty(t);case 4:this.$message({message:"设置职称成功",duration:2e3,type:"success"}),this.setDutyForm.userDuty=this.inputDuty,this.$set(this.userList,this.setDutyIndex,this.setDutyForm),this.setDutyVisible=!1,this.inputDuty="",this.setDutyIndex=-1,e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](1),this.$message({message:"设置职称失败",duration:2e3,type:"error"}),console.log(e.t0);case 16:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}(),handleViewDetails:function(e){this.chosenUser=JSON.parse(JSON.stringify(e)),this.dialogInfoVisible=!0},handleDisable:function(e,t){var s=this;0===t.userIsDisable?this.$confirm("该用户将被禁用，确定要继续吗？","提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}).then(Object(r["a"])(regeneratorRuntime.mark((function i(){var n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n={userId:t.userId},i.prev=1,i.next=4,s.$api.user.disableUser(n);case 4:s.$message({message:"禁用成功",duration:2e3,type:"success"}),s.userList[e].userIsDisable=1,i.next=12;break;case 8:i.prev=8,i.t0=i["catch"](1),s.$message({message:"禁用失败",duration:2e3,type:"error"}),console.log(i.t0);case 12:case"end":return i.stop()}}),i,null,[[1,8]])})))).catch((function(){s.$message({message:"操作已取消",duration:1500,type:"info"})})):this.$confirm("该用户将被启用，确定要继续吗？","提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}).then(Object(r["a"])(regeneratorRuntime.mark((function i(){var n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n={userId:t.userId},i.prev=1,i.next=4,s.$api.user.enableUser(n);case 4:s.$message({message:"启用成功",duration:2e3,type:"success"}),s.userList[e].userIsDisable=0,i.next=12;break;case 8:i.prev=8,i.t0=i["catch"](1),s.$message({message:"启用失败",duration:2e3,type:"error"}),console.log(i.t0);case 12:case"end":return i.stop()}}),i,null,[[1,8]])})))).catch((function(){s.$message({message:"操作已取消",duration:1500,type:"info"})}))}}},l=c,u=(s("9e85"),s("0c7c")),p=Object(u["a"])(l,i,n,!1,null,"c1a9d8ee",null);t["default"]=p.exports},"8b87":function(e,t,s){},"9e85":function(e,t,s){"use strict";s("8b87")}}]);
//# sourceMappingURL=UserManage.4e6576a9.js.map
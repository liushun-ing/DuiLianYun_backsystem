(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["PostManage"],{"0bc2":function(t,e,o){"use strict";o.r(e);var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"crumbs"},[o("el-breadcrumb",{attrs:{separator:"/"}},[o("el-breadcrumb-item",[o("i",{staticClass:"el-icon-lx-cascades"}),t._v(" 帖子管理 ")])],1)],1),o("div",{staticClass:"container"},[o("div",{staticClass:"handle-box"},[o("el-input",{staticClass:"handle-input mr10",attrs:{placeholder:"输入关键词"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearch(e)}},model:{value:t.inputKey,callback:function(e){t.inputKey=e},expression:"inputKey"}}),o("el-button",{attrs:{type:"primary",icon:"el-icon-refresh"},on:{click:t.handleRefresh}},[t._v("刷新")]),o("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleSearch}},[t._v("搜索")]),o("el-button",{attrs:{type:"success",icon:"el-icon-s-flag"},on:{click:t.handleViewAll}},[t._v("标记此页已读")]),o("el-button",{attrs:{type:"warning",icon:"el-icon-upload2"},on:{click:t.handleAddManyToCouplet}},[t._v("将所选入库")])],1),o("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:t.postList,border:"","header-cell-class-name":"table-header"},on:{"selection-change":t.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"55"}}),o("el-table-column",{attrs:{align:"center","min-width":"100",label:"是否已读"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.postStatus?o("el-tag",{attrs:{type:"danger"}},[t._v("未读")]):o("el-tag",{attrs:{type:"info"}},[t._v("已读")])]}}])}),o("el-table-column",{attrs:{prop:"postTitle",label:"帖子标题","min-width":"200",align:"center"}}),o("el-table-column",{attrs:{prop:"postUserName",label:"帖子作者","min-width":"100",align:"center"}}),o("el-table-column",{attrs:{prop:"postFirstLine",label:"帖子上联","min-width":"300",align:"center"}}),o("el-table-column",{attrs:{prop:"postSecondLine",label:"帖子下联","min-width":"300",align:"center"}}),o("el-table-column",{attrs:{prop:"postCreateTime",width:"160",label:"创作时间",align:"center",sortable:""}}),o("el-table-column",{attrs:{label:"操作",width:"180",align:"center",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return["2"!==t.postList[e.$index].postStatus?o("el-button",{staticStyle:{color:"orange"},attrs:{type:"text",icon:"el-icon-upload2"},on:{click:function(o){return t.handleAddToCouplet(e.$index,e.row)}}},[t._v("加入楹联库")]):o("el-button",{staticStyle:{color:"rgb(144, 147, 153)"},attrs:{disabled:"",type:"text",icon:"el-icon-upload2"}},[t._v("已在楹联库")]),o("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(o){return t.handleDelete(e.$index,e.row)}}},[t._v("删除")])]}}])})],1),o("div",{staticClass:"pagination"},[o("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":t.currentPage,"page-size":t.pageSize,total:t.total},on:{"current-change":t.handlePageChange,"prev-click":t.handlePagePrev,"next-click":t.handlePageNext}})],1)],1),o("el-dialog",{attrs:{title:"提示",visible:t.addToCoupletVisible,width:"45%","show-close":!1,"close-on-click-modal":!1},on:{"update:visible":function(e){t.addToCoupletVisible=e}}},[o("div",{staticStyle:{"font-size":"18px","font-weight":"600","padding-bottom":"30px"}},[t._v("该帖子将加入楹联库，确定要继续吗？")]),o("el-checkbox",{model:{value:t.isSendNotice,callback:function(e){t.isSendNotice=e},expression:"isSendNotice"}},[t._v("是否自动发送如下通知")]),o("el-descriptions",{staticStyle:{"padding-top":"10px"},attrs:{column:1,border:""}},[o("el-descriptions-item",{attrs:{label:"通知标题"}},[t._v(t._s(t.noticeForm.noticeTitle))]),o("el-descriptions-item",{attrs:{label:"通知内容"}},[t._v(t._s(t.noticeForm.noticeContent))])],1),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.cancelAddToCouplet}},[t._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:t.saveAddToCouplet}},[t._v("确 定")])],1)],1)],1)},a=[],s=(o("ac6a"),o("96cf"),o("1da1")),i=o("fa7d"),r={name:"PostManage",data:function(){return{inputKey:"",postList:[],currentPage:1,pageSize:10,total:0,noticeForm:"",multipleSelection:[],addToCoupletIndex:-1,addToCoupletForm:{},addToCoupletVisible:!1,isSendNotice:!0}},activated:function(){this.noticeForm=i["a"].getNoticeTemplate(1),this.inputKey="",this.currentPage=1,this.getPostList()},methods:{getPostList:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={pageSize:this.pageSize,currentPage:this.currentPage,inputKey:this.inputKey},t.prev=1,t.next=4,this.$api.post.getPostList(e);case 4:o=t.sent,this.postList=o.postList,this.total=o.total,t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),this.$message({message:"获取帖子列表失败",duration:2e3,type:"error"}),console.log(t.t0);case 13:case"end":return t.stop()}}),t,this,[[1,9]])})));function e(){return t.apply(this,arguments)}return e}(),handleRefresh:function(){var t=this.$message("刷新中");this.currentPage=1,this.inputKey="",this.getPostList(),t.close()},handleSearch:function(){this.currentPage=1,this.getPostList()},handlePageChange:function(t){this.currentPage=t,this.getPostList()},handlePagePrev:function(){this.currentPage--},handlePageNext:function(){this.currentPage++},handleDelete:function(t,e){var o=this,n=e.postUserId,a=e.postTitle;this.$confirm("该帖子将永远删除，确定要继续吗？\r\n删除后将会自动发送一条删除通知给用户","提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}).then(Object(s["a"])(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s={postId:e.postId},t.prev=1,t.next=4,o.$api.post.deletePost(s);case 4:o.$message({message:"删除成功",type:"success",duration:2e3}),o.getPostList(),setTimeout((function(){i["a"].sendNotice(n,7,a)}),1e3),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),o.$message({message:"删除失败",type:"error",duration:2e3}),console.log(t.t0);case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))).catch((function(){o.$message({message:"操作已取消",type:"info",duration:1500})}))},cancelAddToCouplet:function(){this.addToCoupletVisible=!1,this.$message({message:"操作已取消",duration:1500,type:"info"}),this.$refs["addToCoupletForm"].clearValidate()},handleAddToCouplet:function(t,e){this.addToCoupletVisible=!0,this.addToCoupletForm=JSON.parse(JSON.stringify(e)),this.addToCoupletIndex=t,this.noticeForm.setPostTitle(this.addToCoupletForm.postTitle),this.isSendNotice=!0},saveAddToCouplet:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,o=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.addToCoupletVisible=!1,e={coupletId:this.addToCoupletForm.postId,coupletTitle:this.addToCoupletForm.postTitle,coupletFirstLine:this.addToCoupletForm.postFirstLine,coupletSecondLine:this.addToCoupletForm.postSecondLine,coupletAuthorId:this.addToCoupletForm.postUserId,coupletAuthorName:this.addToCoupletForm.postUserName,coupletDynasty:"当代",coupletTypeId:this.addToCoupletForm.postTypeId,coupletFrom:"创作",coupletAppreaciation:this.addToCoupletForm.postAppreaciation,coupletExplanation:this.addToCoupletForm.postExplanation},t.prev=2,t.next=5,this.$api.post.addToCouplet(e);case 5:this.$message({message:"入库成功",type:"success",duration:2e3}),this.postList[this.addToCoupletIndex].postStatus="2",this.isSendNotice&&setTimeout((function(){i["a"].sendNotice(o.addToCoupletForm.postUserId,1,o.addToCoupletForm.postTitle)}),1e3),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](2),this.$message({message:"入库失败",type:"error",duration:2e3}),console.log(t.t0);case 14:case"end":return t.stop()}}),t,this,[[2,10]])})));function e(){return t.apply(this,arguments)}return e}(),handleViewAll:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,o,n=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=[],this.postList.forEach((function(t,o){e.push(t.postId)})),o={postViewList:e},t.prev=3,t.next=6,this.$api.post.viewAll(o);case 6:this.$message({message:"标记已读成功",duration:2e3,type:"success"}),this.postList.forEach((function(t,e){0==t.postStatus&&n.$set(n.postList[e],"postStatus","1")})),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](3),console.log(t.t0),this.$message({message:"标记已读失败",duration:2e3,type:"error"});case 14:case"end":return t.stop()}}),t,this,[[3,10]])})));function e(){return t.apply(this,arguments)}return e}(),handleSelectionChange:function(t){this.multipleSelection=t},handleAddManyToCouplet:function(){var t=this;this.$confirm("确定将所选帖子加入对联库吗？","提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}).then(Object(s["a"])(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=[],t.multipleSelection.forEach((function(t){if("2"!==t.postStatus){var e={coupletId:t.postId,coupletTitle:t.postTitle,coupletFirstLine:t.postFirstLine,coupletSecondLine:t.postSecondLine,coupletAuthorId:t.postUserId,coupletAuthorName:t.postUserName,coupletDynasty:"当代",coupletTypeId:t.postTypeId,coupletFrom:"创作",coupletAppreaciation:t.postAppreaciation,coupletExplanation:t.postExplanation};o.push(e)}})),e.prev=2,e.next=5,t.$api.post.addManyToCouplet(o);case 5:t.$message({message:"入库成功",type:"success",duration:2e3}),t.multipleSelection.forEach((function(e,o){"2"!==e.postStatus&&t.$set(t.postList[o],"postStatus","2")})),e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](2),t.$message({message:"入库失败",type:"error",duration:2e3}),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,9]])})))).catch((function(){t.$message({message:"操作已取消",type:"info",duration:1500})}))}}},l=r,c=(o("aa42"),o("0c7c")),p=Object(c["a"])(l,n,a,!1,null,"75109728",null);e["default"]=p.exports},"0c77":function(t,e,o){},aa42:function(t,e,o){"use strict";o("0c77")}}]);
//# sourceMappingURL=PostManage.06874e51.js.map
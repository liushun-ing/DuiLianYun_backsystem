(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["AwardNoticePush"],{"0413":function(e,t,i){"use strict";i.r(t);var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"crumbs"},[i("el-breadcrumb",{attrs:{separator:"/"}},[i("el-breadcrumb-item",[i("i",{staticClass:"el-icon-lx-calendar"}),e._v(" 通知 ")]),i("el-breadcrumb-item",[e._v("获奖通知")])],1)],1),i("div",{staticClass:"container"},[i("div",{staticStyle:{display:"flex","align-content":"space-between"}},[i("div",{staticClass:"form-box"},[i("div",{staticStyle:{width:"500px","border-right":"#e6e6e6 solid 1px"}},[i("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"通知名称最多十字",prop:"noticeTitle"}},[i("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:"如:比赛获奖通知"},model:{value:e.form.noticeTitle,callback:function(t){e.$set(e.form,"noticeTitle",t)},expression:"form.noticeTitle"}})],1),i("el-form-item",{attrs:{label:"通知内容",prop:"noticeContent"}},[i("el-input",{staticClass:"introduction",attrs:{type:"textarea",rows:"5",placeholder:"只需输入通知正文内容"},model:{value:e.form.noticeContent,callback:function(t){e.$set(e.form,"noticeContent",t)},expression:"form.noticeContent"}})],1),i("el-form-item",{attrs:{label:"比赛",prop:"competitionId"}},[i("el-select",{attrs:{placeholder:"请选择比赛"},on:{change:e.handleSelected},model:{value:e.form.competitionId,callback:function(t){e.$set(e.form,"competitionId",t)},expression:"form.competitionId"}},e._l(e.competitionList,(function(e){return i("el-option",{key:e.competitionId,attrs:{label:e.competitionName,value:e.competitionId}})})),1)],1),i("el-form-item",{attrs:{label:"通知附件小于10M"}},[i("el-upload",{ref:"uploadFile",staticClass:"file_wrap",attrs:{action:"uploadFileURL","http-request":e.uploadFile,"before-upload":e.beforeFileUpload,limit:1}},[i("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击选择附件")])],1)],1),i("el-form-item",[i("el-button",{staticStyle:{width:"200px"},attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("发送")])],1)],1)],1)]),i("div",{staticClass:"template-box"},[i("el-descriptions",{attrs:{title:"通知预览"}},[i("el-descriptions-item",{attrs:{label:"用户"}},[e._v("沉梦昂志")]),i("el-descriptions-item",{attrs:{label:"奖项"}},[e._v("一等奖")])],1),i("el-input",{staticClass:"introduction",attrs:{type:"textarea",rows:"5",placeholder:"只需输入通知正文内容"},model:{value:e.templateNoticeCreator,callback:function(t){e.templateNoticeCreator=t},expression:"templateNoticeCreator"}})],1)])])])},r=[],n=(i("7f7f"),i("96cf"),i("1da1")),a=(i("55dd"),{name:"AwardNoticePush",data:function(){return{form:{noticeTitle:"",noticeContent:"",attachmentSrc:"",competitionId:""},noticeTemplate:{userName:"沉梦昂志",award:"一等奖",competitionName:""},messageObject:"",selectedCompetitionId:"",competitionList:[],rules:{noticeTitle:[{required:!0,message:"请输入通知标题",trigger:"blur"},{min:1,max:10,message:"长度在 1 到 10 个字符"}],noticeContent:[{required:!0,message:"请输入通知内容",trigger:"blur"}],competitionId:[{required:!0,message:"请选择比赛",trigger:["blur","change"]}]}}},activated:function(){this.initCompetitionList()},computed:{templateNoticeCreator:function(){return"恭喜您，"+this.noticeTemplate.userName+"\n您在"+this.noticeTemplate.competitionName+"中荣获"+this.noticeTemplate.award+"!\n"+this.form.noticeContent}},methods:{handleSelected:function(){this.selectedCompetitionId=this.form.competitionId;for(var e=0;e<this.competitionList.length;e++)this.competitionList[e].competitionId==this.selectedCompetitionId&&(this.noticeTemplate.competitionName=this.competitionList[e].competitionName)},sortByTime:function(e){return e.sort((function(e,t){var i=new Date(e.createTime).getTime(),o=new Date(t.createtime).getTime();return i>o?-1:i<o?1:0}))},initCompetitionList:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$api.competition.getAllCompetition();case 3:t=e.sent,this.competitionList=this.sortByTime(t.competitionList),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),console.log(e.t0),this.$message({message:"获取比赛列表失败",duration:2e3,type:"error"});case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}(),uploadFile:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,utils.uploadFile("/user-server/user/uploadPortrait",t.file);case 3:i=e.sent,this.messageObject.close(),this.$set(this.form,"attachmentSrc",i.url),this.$message({message:"文件上传成功",duration:2e3,type:"success"}),e.next=14;break;case 9:e.prev=9,e.t0=e["catch"](0),this.messageObject.close(),console.log(e.t0),this.$message({message:"文件上传失败",duration:2e3,type:"error"});case 14:case"end":return e.stop()}}),e,this,[[0,9]])})));function t(t){return e.apply(this,arguments)}return t}(),beforeFileUpload:function(e){var t=e.name.lastIndexOf("."),i=e.name.slice(t),o=".doc"===i||".pdf"===i||".xls"===i||".xlsx"===i||".docx"===i;if(!o)return this.$message.error("上传文件只能是 doc/docx/pdf/xls/xlsx 格式!"),!1;var r=e.size/1024/1024<10;return r?(this.messageObject=this.$message({message:"上传中",duration:-1}),!0):(this.$message.error("文件大小不能超过10M!"),!1)},onSubmit:function(){var e=this;this.$refs["form"].validate(function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(i){var o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!i){t.next=18;break}return o={noticeTitle:e.form.noticeTitle,noticeContent:"恭喜您，{manuscriptUserName}\n您在"+e.noticeTemplate.competitionName+"中荣获{awardDetail}!\n"+e.form.noticeContent,competitionId:e.selectedCompetitionId,attachmentSrc:e.form.attachmentSrc},t.prev=2,t.next=5,e.$api.notice.noticeAwardUsers(o);case 5:e.$message({message:"通知发送成功",duration:2e3,type:"success"}),e.selectedCompetitionId="",e.form={competitionId:"",noticeTitle:null,noticeContent:""},e.$refs.uploadFile.clearFiles(),e.$refs["form"].clearValidate(),t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](2),e.$message({message:t.t0,duration:2e3,type:"error"}),console.log(t.t0);case 16:t.next=20;break;case 18:return console.log("发送获奖通知表单验证失败"),t.abrupt("return",!1);case 20:case"end":return t.stop()}}),t,null,[[2,12]])})));return function(e){return t.apply(this,arguments)}}())}}}),s=a,c=(i("090a"),i("0c7c")),l=Object(c["a"])(s,o,r,!1,null,"0f127077",null);t["default"]=l.exports},"090a":function(e,t,i){"use strict";i("4ba0")},"4ba0":function(e,t,i){}}]);
//# sourceMappingURL=AwardNoticePush.3e01515f.js.map
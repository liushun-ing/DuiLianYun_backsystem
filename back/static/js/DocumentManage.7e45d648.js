(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["DocumentManage"],{"6e5c":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"crumbs"},[n("el-breadcrumb",{attrs:{separator:"/"}},[n("el-breadcrumb-item",[n("i",{staticClass:"el-icon-lx-cascades"}),e._v(" 资料管理\n            ")])],1)],1),n("div",{staticClass:"container"},[n("div",{staticClass:"handle-box"},[n("el-input",{staticClass:"handle-input mr10",attrs:{placeholder:"名称/简介关键字"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch(t)}},model:{value:e.inputKey,callback:function(t){e.inputKey=t},expression:"inputKey"}}),n("el-button",{attrs:{type:"primary",icon:"el-icon-refresh"},on:{click:e.handleRefresh}},[e._v("刷新")]),n("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("搜索")]),n("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleAdd}},[e._v("新建")])],1),n("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:e.documentList,border:"","header-cell-class-name":"table-header"}},[n("el-table-column",{attrs:{prop:"documentName","min-width":"200",label:"资料名称",align:"center"}}),n("el-table-column",{attrs:{label:"封面图(查看大图)","min-width":"130",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[n("el-image",{staticClass:"table-td-thumb",attrs:{src:e.row.documentPicture,"preview-src-list":[e.row.documentPicture]}})]}}])}),n("el-table-column",{attrs:{prop:"documentIntroduction","min-width":"300",label:"资料简介",align:"center"}}),n("el-table-column",{attrs:{prop:"documentCreateTime",width:"160",label:"入库时间",align:"center",sortable:""}}),n("el-table-column",{attrs:{prop:"documentScore","min-width":"100",label:"评分",align:"center"}}),n("el-table-column",{attrs:{label:"操作",width:"200",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{staticClass:"green",attrs:{type:"text",icon:"el-icon-download"},on:{click:function(n){return e.handleDownload(t.$index,t.row)}}},[e._v("查看/下载")]),n("el-button",{staticClass:"blue",attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(n){return e.handleEdit(t.$index,t.row)}}},[e._v("修改")]),n("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(n){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),n("div",{staticClass:"pagination"},[n("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":e.currentPage,"page-size":e.pageSize,total:e.total},on:{"current-change":e.handlePageChange,"prev-click":e.handlePagePrev,"next-click":e.handlePageNext}})],1)],1),n("el-dialog",{attrs:{title:"编辑",visible:e.editVisible,width:"30%","show-close":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editVisible=t}}},[n("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.rules,"label-width":"90px"}},[n("el-form-item",{attrs:{label:"资料名称",prop:"documentName"}},[n("el-input",{model:{value:e.editForm.documentName,callback:function(t){e.$set(e.editForm,"documentName",t)},expression:"editForm.documentName"}})],1),n("el-form-item",{attrs:{label:"资料简介",prop:"documentIntroduction"}},[n("el-input",{attrs:{type:"textarea",autosize:""},model:{value:e.editForm.documentIntroduction,callback:function(t){e.$set(e.editForm,"documentIntroduction",t)},expression:"editForm.documentIntroduction"}})],1),n("el-form-item",{attrs:{label:"资料封面图最优宽高3:4",prop:"masterPhoto"}},[n("el-upload",{ref:"upload",staticClass:"do-avatar-uploader",attrs:{action:"uploadUrl","show-file-list":!1,limit:1,"http-request":e.uploadPicture,"before-upload":e.beforeAvatarUpload}},[e.editForm.documentPicture?n("el-image",{staticClass:"do-avatar",attrs:{src:e.editForm.documentPicture,fit:"contain"}}):n("i",{staticClass:"el-icon-plus do-avatar-uploader-icon"})],1)],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.cancelEdit}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.saveEdit("editForm")}}},[e._v("确 定")])],1)],1)],1)},a=[],i=(n("96cf"),n("1da1")),o=n("fa7d"),c={name:"DocumentManage",data:function(){return{inputKey:"",documentList:[],pageSize:10,currentPage:1,total:0,editForm:{},editIndex:-1,editVisible:!1,whetherChange:!1,rules:{documentName:[{required:!0,message:"请输入资料名",trigger:"blur"}],documentIntroduction:[{required:!0,message:"请输入资料简介",trigger:"blur"}],documentPicture:[{required:!0,message:"请选择图片",trigger:"blur"}]}}},activated:function(){this.inputKey="",this.currentPage=1,this.getDocumentList()},methods:{getDocumentList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={currentPage:this.currentPage,pageSize:this.pageSize,inputKey:this.inputKey},e.prev=1,e.next=4,this.$api.document.getDocumentList(t);case 4:n=e.sent,this.documentList=n.documentList,this.total=n.total,e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](1),this.$message({message:"获取资料列表失败",duration:2e3,type:"error"}),console.log(e.t0);case 13:case"end":return e.stop()}}),e,this,[[1,9]])})));function t(){return e.apply(this,arguments)}return t}(),handleRefresh:function(){var e=this.$message("刷新中");this.currentPage=1,this.inputKey="",this.getDocumentList(),e.close()},handleSearch:function(){this.currentPage=1,this.getDocumentList()},handlePageChange:function(e){this.currentPage=e,this.getDocumentList()},handlePagePrev:function(){this.currentPage--},handlePageNext:function(){this.currentPage++},deletePhoto:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={url:t},e.prev=1,e.next=4,this.$api.document.deletePicture(n);case 4:console.log("新闻原有图片删除成功"),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](1),console.log("新闻原有图片删除失败"),console.log(e.t0);case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));function t(t){return e.apply(this,arguments)}return t}(),beforeAvatarUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type;return t?this.$message({message:"上传中"}):this.$message.error("上传封面图片只能是 JPG或者PNG 格式!"),t},uploadPicture:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o["a"].uploadFile("/file-server/document/back/uploadPicture",t.file);case 3:n=e.sent,this.$set(this.editForm,"documentPicture",n.url),this.$message({message:"图片上传成功",duration:2e3,type:"success"}),this.whetherChange=!0,this.$refs.upload.clearFiles(),e.next=15;break;case 10:e.prev=10,e.t0=e["catch"](0),this.$refs.upload.clearFiles(),console.log(e.t0),this.$message({message:"图片上传失败",duration:2e3,type:"error"});case 15:case"end":return e.stop()}}),e,this,[[0,10]])})));function t(t){return e.apply(this,arguments)}return t}(),handleDelete:function(e,t){var n=this;this.$confirm("该资料将永久删除，确定要继续吗","提示",{type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={documentId:t.documentId},e.prev=1,e.next=4,n.$api.document.deleteDocument(r);case 4:return n.$message({message:"删除资料成功",duration:2e3,type:"success"}),r={fileId:t.documentFileId},e.prev=6,e.next=9,n.$api.document.deleteFile(r);case 9:console.log("资料配套文件删除成功"),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](6),console.log("资料配套文件删除失败"),console.log(e.t0);case 16:return r={url:t.documentPicture},e.prev=17,e.next=20,n.$api.document.deletePicture(r);case 20:console.log("资料图片删除成功"),e.next=27;break;case 23:e.prev=23,e.t1=e["catch"](17),console.log("资料图片删除失败"),console.log(e.t1);case 27:n.getDocumentList(),e.next=34;break;case 30:e.prev=30,e.t2=e["catch"](1),n.$message({message:"删除资料失败",duration:2e3,type:"error"}),console.log(e.t2);case 34:n.getDocumentList();case 35:case"end":return e.stop()}}),e,null,[[1,30],[6,12],[17,23]])})))).catch((function(){n.$message({message:"操作已取消",duration:1500,type:"info"})}))},cancelEdit:function(){this.editVisible=!1,this.$message({message:"操作已取消",duration:1500,type:"info"}),this.$refs["editForm"].clearValidate()},handleEdit:function(e,t){this.editIndex=e,this.editForm=JSON.parse(JSON.stringify(t)),this.editVisible=!0},saveEdit:function(e){var t=this;this.$refs[e].validate(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(n){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!n){e.next=18;break}return r=t.documentList[t.editIndex].documentPicture,t.editVisible=!1,a={documentId:t.editForm.documentId,documentName:t.editForm.documentName,documentIntroduction:t.editForm.documentIntroduction},e.prev=4,e.next=7,t.$api.document.modifyDocument(a);case 7:t.$message({message:"修改资料成功",duration:2e3,type:"success"}),t.$set(t.documentList,t.editIndex,t.editForm),t.whetherChange&&t.deletePhoto(r),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](4),t.$message({message:"修改资料失败",duration:2e3,type:"error"}),console.log(e.t0);case 16:e.next=20;break;case 18:return console.log("修改资料表单验证失败"),e.abrupt("return",!1);case 20:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}())},handleDownload:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={fileId:n.documentFileId},e.prev=1,e.next=4,this.$api.document.getFile(r);case 4:a=e.sent,window.open(a.filePath),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](1),this.$message({message:"获取相关文件失败",duration:2e3,type:"error"}),console.log(e.t0);case 12:case"end":return e.stop()}}),e,this,[[1,8]])})));function t(t,n){return e.apply(this,arguments)}return t}(),handleAdd:function(){this.$router.push({name:"DocumentUpload"})}}},s=c,l=(n("7a78"),n("0c7c")),u=Object(l["a"])(s,r,a,!1,null,null,null);t["default"]=u.exports},"7a78":function(e,t,n){"use strict";n("c9f8")},c9f8:function(e,t,n){}}]);
//# sourceMappingURL=DocumentManage.7e45d648.js.map